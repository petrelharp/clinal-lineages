README

This repo contains all the scripts used to analyze, simulate and make figures for the paper "Beyond clines: lineages and haplotype blocks in hybrid zones"

The code is messy, and I do not recommend trying to use this. There are, and will be, faster and more user-friendly forward simulators out there. 


SIMULATIONS:
	sims-fns.R contains many of the functions required to run yaniv-sims2.R
	
	run_sims.R  will run the simulation. Edit the first few lines of this file to specify parameters:
	params = list(
    SIGMA = 3,        # sigma for dispersal, in deme spacings
    ndemes = 100,     # number of demes
    deme_size = 50,   # number of diploid individuals per deme
    S = 0.05,         # selection coefficient, s
    zone_age = 10     # number of generations to run simulation for
	)

	
	It will create files in the format 	`simulation_SIGMA%s_Ninds%s_ndemes%s_s%s_dir/tau%s_dir/results_runid_%s`,
	including some useful plots. (runid is automatically generated by the script)	
	

There are 4 output files:
	*params.Robj; records the parameters used for this run
	 
	*rawoutput.Robj; the raw output of the simulator function
	
	*simsums.Robj; parsing of the rawoutput object

	For these, a description of the information, and how it is organized, can be found in the comments of the R script.
	
	*simsums_chunks.Robj; the distribution of chunks around a provided set of loci. 
	
	This is a list with components: selected (at the selected site), distant (at recombination distance 0.01), unlinked (at the center of the other chromosome)
	Each element of the list is a list with one entry per deme: a (m x n) matrix of chunk sizes (m=deme_size, n=ploidy) with colnames "X1" and "X2" for the chromosomes. Each entry in the matrix gives the chunk size of Ancestry B surrounding the locus (0 means the locus is of ancestry A).
	
Additionally, sims-fns.R will generate a slew of summary figures for mainly diagnostic purposes:
	
	*freqplot.pdf; plot of allele frequencies across space at specified loci
	
	*chunks_density.pdf; distribution of chunk sizes
	
	*chunks_ecdf.pdf; estimated cumulative distribution function of chunk sizes for each deme
	
	*chunks_mean.pdf; chunk lengths across simulated chromosome
	

To get the family size of lineages, run number_of_inds.R, editing the file directly to specify the simulation to be analyzed. This will generate an R object file 



NUMERICAL:
Most of these files can be found in the "notes" directory.
To compare numerical solution for allele frequency clines:
First `devtools::install_github("petrelharp/templater")` and then run e.g.

make simulation_SIGMA1_Ninds5000_ndemes100_s0.1_dir/tau500_dir/results_comparison-to-theory.html

or even

SIMDIR=simulation_SIGMA1_Ninds5000_ndemes100_s0.1_dir/
for x in $(find $SIMDIR -name "*_simsums_chunks.Robj")
do 
    y=$(echo $x | sed -e 's/_simsums_chunks.Robj/_comparison-to-theory.html/') 
    make $y
done


FIGURES:
-Potential_statistics.R will generate the following plots and R object files:
	*statistic_length.pdf; mean length across ALL indivduals in the zone (including non-recombinant chroms) vs chromosome position
	
	*statistic_ecdf.pdf; ECDF of length (i.e. prob that random haplotype is longer than this one) relative to ALL individuals in a given population.

	*statistic_length_of_adjacent_blocks.pdf; mean length of blocks adjacent to the block containing the selected locus.
	
	*intervalSizes.Robj
	*intervalSizes_allAncs.Robj
	*flanking.blocks.by.ind.Robj 
	*flanking.blocks.by.ind.AncB.Robj
	
-blockLengthPlotsS0.001 provides examples of how to turn these into plots and heatmaps as they appear in the manuscript (e.g. Figure 5)
	

-Plot_frequency_clines.R will plot ancestry frequency clines for multiple loci across the genome for both (Corresponds to Fig. 2 in the manuscript). This will require paths to the following files: sims-fns.R, tran.1D.R, cline-fns.R, chunks_fns.R 


number_of_ancestors.R will plot the average family size of migrants. You will need to run number_of_inds.R first. A lot of variables are hard-coded (sorry!), so these will need to be modified to suit your needs.

